[32minfo[39m: Supabase admin client created (for storage operations) {"service":"integrations-backend","timestamp":"2025-12-01T10:28:15.434Z"}
[32minfo[39m: Using Supabase admin client for backend operations {"service":"integrations-backend","timestamp":"2025-12-01T10:28:15.439Z"}
[33mwarn[39m: ENCRYPTION_KEY missing or too short; using derived key from JWT_SECRET. Set ENCRYPTION_KEY for production. {"service":"integrations-backend","timestamp":"2025-12-01T10:28:15.494Z"}
â‰¡Æ’ÃœÃ‡ Triggering Gmail ingestion for user: stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649
[32minfo[39m: â‰¡Æ’Ã¶Ã¬ [GMAIL INGESTION] Starting evidence ingestion from Gmail {"maxResults":5,"service":"integrations-backend","timestamp":"2025-12-01T10:28:15.638Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[32minfo[39m: Supabase connected successfully {"service":"integrations-backend","timestamp":"2025-12-01T10:28:15.645Z"}
[32minfo[39m: â‰¡Æ’ÂºÂ¬ [GMAIL MOCK] Returning mock emails for testing {"service":"integrations-backend","timestamp":"2025-12-01T10:28:16.180Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[32minfo[39m: Î“Â£Ã  [GMAIL INGESTION] Fetched 2 emails from Gmail {"emailCount":2,"service":"integrations-backend","timestamp":"2025-12-01T10:28:16.181Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[32minfo[39m: â‰¡Æ’ÂºÂ¬ [GMAIL MOCK] Returning mock message with attachment {"messageId":"mock-email-1764584896181-0","service":"integrations-backend","timestamp":"2025-12-01T10:28:16.183Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[33mwarn[39m: Gmail request unauthorized, refreshing token {"service":"integrations-backend","status":401,"timestamp":"2025-12-01T10:28:17.012Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[31merror[39m: Error refreshing Gmail access token {"error":{"code":"ERR_BAD_REQUEST","config":{"adapter":["xhr","http","fetch"],"allowAbsoluteUrls":true,"data":"{\"grant_type\":\"refresh_token\",\"refresh_token\":\"mock-refresh-56afbf7d-ef8f-417f-ba7f-cf92c979887b\"}","env":{},"headers":{"Accept":"application/json, text/plain, */*","Accept-Encoding":"gzip, compress, deflate, br","Content-Length":"98","Content-Type":"application/json","User-Agent":"axios/1.12.2"},"maxBodyLength":-1,"maxContentLength":-1,"method":"post","timeout":0,"transformRequest":[null],"transformResponse":[null],"transitional":{"clarifyTimeoutError":false,"forcedJSONParsing":true,"silentJSONParsing":true},"url":"https://oauth2.googleapis.com/token","xsrfCookieName":"XSRF-TOKEN","xsrfHeaderName":"X-XSRF-TOKEN"},"message":"Request failed with status code 400","name":"AxiosError","stack":"AxiosError: Request failed with status code 400\n    at settle (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\node_modules\\axios\\lib\\core\\settle.js:19:12)\n    at Unzip.handleStreamEnd (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\node_modules\\axios\\lib\\adapters\\http.js:617:11)\n    at Unzip.emit (node:events:530:35)\n    at Unzip.emit (node:domain:489:12)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\node_modules\\axios\\lib\\core\\Axios.js:45:41)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GmailService.refreshAccessToken (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailService.ts:129:24)\n    at async GmailService.requestWithToken (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailService.ts:408:23)\n    at async GmailService.fetchAttachment (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailService.ts:349:22)\n    at async GmailIngestionService.extractAttachmentsFromEmail (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailIngestionService.ts:235:38)\n    at async GmailIngestionService.ingestEvidenceFromGmail (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailIngestionService.ts:94:31)\n    at async triggerIngestion (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\scripts\\trigger-ingestion.ts:16:24)","status":400},"service":"integrations-backend","timestamp":"2025-12-01T10:28:17.950Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[33mwarn[39m: Î“ÃœÃ¡âˆ©â••Ã… [GMAIL INGESTION] Failed to download attachment content {"attachmentId":"mock-attachment-mock-email-1764584896181-0","emailId":"mock-email-1764584896181-0","error":"Failed to refresh Gmail access token","service":"integrations-backend","timestamp":"2025-12-01T10:28:17.952Z"}
[32minfo[39m: â‰¡Æ’Ã´Ã„ [GMAIL INGESTION] Found 1 attachments in email {"attachmentCount":1,"emailId":"mock-email-1764584896181-0","service":"integrations-backend","subject":"Amazon Invoice #3839","timestamp":"2025-12-01T10:28:17.952Z"}
[31merror[39m: Î“Â¥Ã® [GMAIL INGESTION] Failed to create evidence source {"error":{"code":"23502","details":"Failing row contains (52dd3d58-719a-4186-a1f4-bab914a8326c, null, gmail, connected, null, {\"source\": \"gmail_api\", \"connected_at\": \"2025-12-01T10:28:19.293..., 2025-12-01 10:28:20.360475+00, 2025-12-01 10:28:20.360475+00, null, 78fecfc0-5bf7-4387-9084-38d4733b9649, auto-confirm@amazon.com, null, null, null, [], null).","hint":null,"message":"null value in column \"seller_id\" of relation \"evidence_sources\" violates not-null constraint"},"service":"integrations-backend","timestamp":"2025-12-01T10:28:19.661Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[32minfo[39m: â‰¡Æ’ÂºÂ¬ [GMAIL MOCK] Returning mock message with attachment {"messageId":"mock-email-1764584896181-1","service":"integrations-backend","timestamp":"2025-12-01T10:28:19.661Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[33mwarn[39m: Gmail request unauthorized, refreshing token {"service":"integrations-backend","status":401,"timestamp":"2025-12-01T10:28:20.222Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[31merror[39m: Error refreshing Gmail access token {"error":{"code":"ERR_BAD_REQUEST","config":{"adapter":["xhr","http","fetch"],"allowAbsoluteUrls":true,"data":"{\"grant_type\":\"refresh_token\",\"refresh_token\":\"mock-refresh-56afbf7d-ef8f-417f-ba7f-cf92c979887b\"}","env":{},"headers":{"Accept":"application/json, text/plain, */*","Accept-Encoding":"gzip, compress, deflate, br","Content-Length":"98","Content-Type":"application/json","User-Agent":"axios/1.12.2"},"maxBodyLength":-1,"maxContentLength":-1,"method":"post","timeout":0,"transformRequest":[null],"transformResponse":[null],"transitional":{"clarifyTimeoutError":false,"forcedJSONParsing":true,"silentJSONParsing":true},"url":"https://oauth2.googleapis.com/token","xsrfCookieName":"XSRF-TOKEN","xsrfHeaderName":"X-XSRF-TOKEN"},"message":"Request failed with status code 400","name":"AxiosError","stack":"AxiosError: Request failed with status code 400\n    at settle (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\node_modules\\axios\\lib\\core\\settle.js:19:12)\n    at Unzip.handleStreamEnd (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\node_modules\\axios\\lib\\adapters\\http.js:617:11)\n    at Unzip.emit (node:events:530:35)\n    at Unzip.emit (node:domain:489:12)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\node_modules\\axios\\lib\\core\\Axios.js:45:41)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GmailService.refreshAccessToken (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailService.ts:129:24)\n    at async GmailService.requestWithToken (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailService.ts:408:23)\n    at async GmailService.fetchAttachment (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailService.ts:349:22)\n    at async GmailIngestionService.extractAttachmentsFromEmail (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailIngestionService.ts:235:38)\n    at async GmailIngestionService.ingestEvidenceFromGmail (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\services\\gmailIngestionService.ts:94:31)\n    at async triggerIngestion (C:\\Users\\Student\\Contacts\\Clario-Complete-Backend\\Integrations-backend\\src\\scripts\\trigger-ingestion.ts:16:24)","status":400},"service":"integrations-backend","timestamp":"2025-12-01T10:28:20.779Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[33mwarn[39m: Î“ÃœÃ¡âˆ©â••Ã… [GMAIL INGESTION] Failed to download attachment content {"attachmentId":"mock-attachment-mock-email-1764584896181-1","emailId":"mock-email-1764584896181-1","error":"Failed to refresh Gmail access token","service":"integrations-backend","timestamp":"2025-12-01T10:28:20.779Z"}
[32minfo[39m: â‰¡Æ’Ã´Ã„ [GMAIL INGESTION] Found 1 attachments in email {"attachmentCount":1,"emailId":"mock-email-1764584896181-1","service":"integrations-backend","subject":"Amazon Invoice #89712","timestamp":"2025-12-01T10:28:20.780Z"}
[31merror[39m: Î“Â¥Ã® [GMAIL INGESTION] Failed to create evidence source {"error":{"code":"23502","details":"Failing row contains (5e66f388-6e5a-4ab3-98ee-c1454082ce5b, null, gmail, connected, null, {\"source\": \"gmail_api\", \"connected_at\": \"2025-12-01T10:28:22.159..., 2025-12-01 10:28:23.22691+00, 2025-12-01 10:28:23.22691+00, null, 78fecfc0-5bf7-4387-9084-38d4733b9649, auto-confirm@amazon.com, null, null, null, [], null).","hint":null,"message":"null value in column \"seller_id\" of relation \"evidence_sources\" violates not-null constraint"},"service":"integrations-backend","timestamp":"2025-12-01T10:28:22.523Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}
[32minfo[39m: Î“Â£Ã  [GMAIL INGESTION] Evidence ingestion completed {"documentsIngested":0,"elapsedTime":"6.89s","emailsProcessed":2,"errors":0,"service":"integrations-backend","timestamp":"2025-12-01T10:28:22.524Z","userId":"stress-test-user-78fecfc0-5bf7-4387-9084-38d4733b9649"}

Î“Â£Ã  Ingestion Result: {
  "success": true,
  "documentsIngested": 0,
  "emailsProcessed": 2,
  "errors": []
}
